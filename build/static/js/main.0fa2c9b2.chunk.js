(this.webpackJsonptidesofbattle_front=this.webpackJsonptidesofbattle_front||[]).push([[0],{43:function(r,e,n){},64:function(r,e,n){},69:function(r,e,n){"use strict";n.r(e);var t,a=n(0),c=n.n(a),s=n(35),u=n.n(s),o=(n(43),n(17)),i=n(3),d=n.n(i),l=n(5),p=n(18),f=n(13),b=n.p+"static/media/one_sword.700197e8.jpg",v=n.p+"static/media/one_tower.6ae8d412.jpg",O=n.p+"static/media/zero.da497042.jpg",h=n.p+"static/media/zero_skull.e9f10cf5.jpg",w=n.p+"static/media/two.44ef7bc4.jpg",j=n.p+"static/media/three.4ee9cadd.jpg",m=n.p+"static/media/backside.bc07350a.jpg",x=n(4),g={zero:O,zero_skull:h,one_sword:b,one_tower:v,two:w,three:j},S=function(r){var e=r.card,n=r.username,t=r.handleSelect,a=e.cardName,c=e.cardOwner,s=e.cardIndex,u=g[a]||m,o=a||"unknown",i={backgroundColor:c?c===n?"red":"cyan":null};return Object(x.jsxs)("div",{className:"tidecard-wrap",style:i,onDoubleClick:function(){return t(s)},children:[Object(x.jsx)("img",{className:"tidecard",src:u,alt:o}),"CardOwner: ",c]})},k=n(12),E=n.n(k),C=function(r){t=r?"bearer ".concat(r):null},y=function(){return{headers:{Authorization:t}}},N=C;console.log("production","http://localhost:3001/api");var R="./api",U="".concat(R,"/cards"),D=function(){var r=Object(l.a)(d.a.mark((function r(e){var n,t,a;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,n=y(),r.next=4,E.a.post("".concat(U,"/select"),{cardIndex:e},n);case 4:return t=r.sent,a=t.data,r.abrupt("return",a);case 9:return r.prev=9,r.t0=r.catch(0),console.error(r.t0),r.abrupt("return",null);case 13:case"end":return r.stop()}}),r,null,[[0,9]])})));return function(e){return r.apply(this,arguments)}}(),I={cardsSSE:function(){try{return new EventSource("".concat(U,"/sse"))}catch(r){console.error(r)}},forceEnd:function(){var r=Object(l.a)(d.a.mark((function r(){var e,n;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,e=y(),r.next=4,E.a.get("".concat(U,"/forceEnd"),e);case 4:return n=r.sent,r.abrupt("return",204===n.status);case 8:return r.prev=8,r.t0=r.catch(0),console.error(r.t0),r.abrupt("return",!1);case 12:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(){return r.apply(this,arguments)}}(),nosword:function(){var r=Object(l.a)(d.a.mark((function r(){var e,n;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,e=y(),r.next=4,E.a.get("".concat(U,"/nosword"),e);case 4:return n=r.sent,r.abrupt("return",204===n.status);case 8:return r.prev=8,r.t0=r.catch(0),console.error(r.t0),r.abrupt("return",!1);case 12:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(){return r.apply(this,arguments)}}(),select:D,initialLoad:function(){var r=Object(l.a)(d.a.mark((function r(){var e,n,t,a,c,s;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,e=y(),r.next=4,E.a.get("".concat(U,"/initialLoad"),e);case 4:return n=r.sent,t=n.data,a=t.selectedCards,c=a.ownCards,s=a.othersCards,r.abrupt("return",{swordOwner:t.swordOwner,ownCards:c,othersCards:s});case 10:return r.prev=10,r.t0=r.catch(0),console.error(r.t0),r.abrupt("return",null);case 14:case"end":return r.stop()}}),r,null,[[0,10]])})));return function(){return r.apply(this,arguments)}}()},A=function r(e){var n=I.cardsSSE();return n.onopen=function(){console.log("CARD SUB ACTIVE")},n.onerror=function(){console.error("CARD SUB ERROR"),n.close(),setTimeout((function(){return r(e)}),1e4)},n.onmessage=function(r){console.log("CSUB MSG"),function(r,e){try{var n=JSON.parse(r);switch(console.log(n.msg),n.msg){case"end":return n.cards,e((function(r){var e=n.cards,t=r.username,a=e.filter((function(r){return""!==r.cardOwner&&r.cardOwner!==t}));return Object(f.a)(Object(f.a)({},r),{},{cards:e,othersCards:a,waitingForSword:""})})),void console.log("ROUND END");case"nosword":return n.username,void console.log(n.username,"NOSWORD");case"select":return void e((function(r){var e=n.cardIndex,t=n.cardOwner;return r.cards[e].cardOwner=t,Object(f.a)({},r)}));case"forceEnd":return void console.log(n.username,"FORCE END");case"too-many-users":return n.usernames,void console.log("TOO MANY USER SELECTED CARDS",n.usernames);case"waiting-sword":return n.username,void e((function(r){return Object(f.a)(Object(f.a)({},r),{},{waitingForSword:n.username})}));case"sword-change":return console.log(n.doneBy,"SWORD USER CHANGED TO",n.username),void e((function(r){return Object(f.a)(Object(f.a)({},r),{},{swordOwner:n.username})}));default:console.error("UNDEFINED SSE MSG",n)}}catch(t){console.error(t,r)}}(r.data,e)},n},T=function(){for(var r=[],e=0;e<24;e++)r.push({cardName:"",cardOwner:"",cardIndex:e});return r},F=function(r){var e=r.username,n=r.usernameOptions,t=Object(a.useState)((function(){return function(r,e){return{cards:T(),selectedCards:[],ownCards:[],othersCards:[],waitingForSword:"",swordOwner:"",usernameOptions:e,username:r}}(e,n)})),c=Object(o.a)(t,2),s=c[0],u=c[1];Object(a.useEffect)((function(){(function(){var r=Object(l.a)(d.a.mark((function r(){var e,n,t,a,c;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,I.initialLoad();case 2:e=r.sent,n=e.swordOwner,t=e.ownCards,a=e.othersCards,c=[].concat(Object(p.a)(t),Object(p.a)(a)),u((function(r){var e=r.cards;return c.forEach((function(r){var n=r.cardOwner,t=r.cardIndex;e[t].cardOwner=n})),Object(f.a)(Object(f.a)({},r),{},{cards:e,swordOwner:n,ownCards:t,othersCards:a})}));case 6:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}})()();var r=A(u);return function(){return r.close()}}),[]);var i=function(){var r=Object(l.a)(d.a.mark((function r(e){var n,t,a,c,o,i,l,p,b;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=s.username,t=s.swordOwner,a=s.cards,c=s.ownCards,o=s.othersCards,""===a[e].cardOwner){r.next=4;break}return r.abrupt("return");case 4:if(i=a.filter((function(r){return""!==r.cardOwner})),l=i.filter((function(r){return r.cardOwner===n})),1!==i.length||1!==l.length){r.next=8;break}return r.abrupt("return");case 8:if(2!==i.length||1===l.length&&t===n){r.next=10;break}return r.abrupt("return");case 10:if(p=[c.length,o.length,i.length],p[0]+p[1]===p[2]){r.next=13;break}return r.abrupt("return");case 13:return r.next=15,I.select(e);case 15:if(b=r.sent){r.next=18;break}return r.abrupt("return");case 18:u((function(r){return r.ownCards.push(b),Object(f.a)({},r)}));case 19:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),b=function(){var r=Object(l.a)(d.a.mark((function r(){return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(O===e){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,I.nosword();case 4:r.sent;case 5:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),v=function(){var r=Object(l.a)(d.a.mark((function r(){return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,I.forceEnd();case 2:r.sent;case 3:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),O=s.swordOwner,h=s.cards.map((function(r){return Object(x.jsx)(S,{username:e,card:r,handleSelect:i},r.cardIndex)})),w=O===e,j=!1;if(w){var m=s.cards.filter((function(r){return""!==r.cardOwner})),g=m.filter((function(r){return r.cardOwner===e}));2===m.length&&1===g.length&&(j=!0)}return Object(x.jsxs)("div",{style:{display:"grid"},children:[Object(x.jsx)("div",{style:{display:"flex",overflow:"auto"},children:h}),w&&Object(x.jsx)("button",{disabled:!j,onClick:b,children:"DONT USE SWORD"}),Object(x.jsx)("div",{style:{height:55}}),w&&Object(x.jsx)("button",{onClick:v,children:"FORCE RESET - FOR BUGS ONLY"}),Object(x.jsx)("div",{})]})},_="".concat(R,"/users"),L={login:function(){var r=Object(l.a)(d.a.mark((function r(e){var n,t,a;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,n=y(),r.next=4,E.a.post("".concat(_,"/login"),{username:e},n);case 4:if(t=r.sent,a=t.data.token){r.next=9;break}return console.error(t),r.abrupt("return",null);case 9:return C(a),r.abrupt("return",a);case 13:return r.prev=13,r.t0=r.catch(0),console.error(r.t0),r.abrupt("return",null);case 17:case"end":return r.stop()}}),r,null,[[0,13]])})));return function(e){return r.apply(this,arguments)}}(),usernames:function(){var r=Object(l.a)(d.a.mark((function r(){var e,n;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,e=y(),r.next=4,E.a.get("".concat(_,"/usernames"),e);case 4:return n=r.sent,r.abrupt("return",n.data||[]);case 8:return r.prev=8,r.t0=r.catch(0),console.error(r.t0),r.abrupt("return",["FAILED TO GET USERNAMES - REFRESH PAGE"]);case 12:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(){return r.apply(this,arguments)}}(),stats:function(){var r=Object(l.a)(d.a.mark((function r(){var e,n;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,e=y(),r.next=4,E.a.get("".concat(_,"/stats"),e);case 4:return n=r.sent,r.abrupt("return",n);case 8:return r.prev=8,r.t0=r.catch(0),console.error(r.t0),r.abrupt("return",r.t0);case 12:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(){return r.apply(this,arguments)}}(),changeSwordUser:function(){var r=Object(l.a)(d.a.mark((function r(e){var n,t;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,n=y(),r.next=4,E.a.post("".concat(_,"/changeSwordUser"),{newSwordUser:e},n);case 4:return t=r.sent,r.abrupt("return",204===t.status);case 8:return r.prev=8,r.t0=r.catch(0),console.error(r.t0),r.abrupt("return",!1);case 12:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(e){return r.apply(this,arguments)}}(),addUser:function(){var r=Object(l.a)(d.a.mark((function r(e){var n,t;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,n=y(),r.next=4,E.a.post("".concat(_,"/add"),{username:e},n);case 4:return t=r.sent,r.abrupt("return",204===t.status);case 8:return r.prev=8,r.t0=r.catch(0),console.error(r.t0),r.abrupt("return",!1);case 12:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(e){return r.apply(this,arguments)}}()},B=(n(64),n(91)),G=n(95),z=n(94),M=n(93),W=function(r,e){localStorage.setItem("Username",r),localStorage.setItem("Token",e)},J=Object(B.a)((function(r){return{formControl:{margin:r.spacing(1),minWidth:120}}})),H=function(r){var e=r.username,n=r.setUsername,t=r.usernameOptions,a=J(),c=function(){var r=Object(l.a)(d.a.mark((function r(e){var t,a;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t=e.target.value){r.next=3;break}return r.abrupt("return");case 3:return r.next=5,L.login(t);case 5:if(a=r.sent){r.next=9;break}return console.log("login failed"),r.abrupt("return");case 9:W(t,a),n(t);case 11:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),s=t.map((function(r){return Object(x.jsx)("option",{value:r,children:r},r)}));return Object(x.jsx)("div",{children:Object(x.jsxs)(z.a,{className:a.formControl,children:[Object(x.jsx)(G.a,{shrink:!0,htmlFor:"username-native-label-placeholder",children:"Username"}),Object(x.jsxs)(M.a,{value:e,onChange:c,inputProps:{name:"username",id:"username-native-label-placeholder"},children:[Object(x.jsx)("option",{value:"",children:"None"}),s]})]})})},P=function(){var r=Object(a.useState)((function(){return function(){var r=localStorage.getItem("Username"),e=localStorage.getItem("Token");return r&&e?(N(e),r):""}()})),e=Object(o.a)(r,2),n=e[0],t=e[1],c=Object(a.useState)([]),s=Object(o.a)(c,2),u=s[0],i=s[1];if(Object(a.useEffect)((function(){(function(){var r=Object(l.a)(d.a.mark((function r(){var e;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,L.usernames();case 2:e=r.sent,i(e);case 4:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}})()()}),[]),!n)return Object(x.jsx)("div",{className:"App",children:Object(x.jsx)(H,{username:n,setUsername:t,usernameOptions:u})});return Object(x.jsxs)("div",{className:"App",children:[Object(x.jsx)("div",{children:Object(x.jsx)("button",{onClick:function(){return localStorage.clear(),void t("")},children:"Logout"})}),Object(x.jsx)(F,{username:n,usernameOptions:u})]})};u.a.render(Object(x.jsx)(c.a.StrictMode,{children:Object(x.jsx)(P,{})}),document.getElementById("root"))}},[[69,1,2]]]);
//# sourceMappingURL=main.0fa2c9b2.chunk.js.map
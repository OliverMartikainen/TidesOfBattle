(this.webpackJsonptidesofbattle_front=this.webpackJsonptidesofbattle_front||[]).push([[0],{43:function(e,r,n){},68:function(e,r,n){},69:function(e,r,n){"use strict";n.r(r);var t,a=n(0),c=n.n(a),s=n(35),u=n.n(s),o=(n(43),n(17)),i=n(2),l=n.n(i),d=n(5),p=n(18),f=n(13),b=n.p+"static/media/one_sword_lite.4871870e.jpg",O=n.p+"static/media/one_tower_lite.5422d4d2.jpg",v=n.p+"static/media/zero_lite.09307b16.jpg",h=n.p+"static/media/zero_skull_lite.3d9aee36.jpg",w=n.p+"static/media/two_lite.e588a68b.jpg",j=n.p+"static/media/three_lite.0750c14f.jpg",m=n.p+"static/media/backside_lite.24c30a04.jpg",x=n(4),g={zero:v,zero_skull:h,one_sword:b,one_tower:O,two:w,three:j},S=function(e){var r=e.card,n=e.username,t=e.handleSelect,a=r.cardName,c=r.cardOwner,s=r.cardIndex,u=g[a]||m,o=a||"unknown",i={backgroundColor:c?c===n?"red":"cyan":null};return Object(x.jsxs)("div",{className:"tidecard-wrap",style:i,onDoubleClick:function(){return t(s)},children:[Object(x.jsx)("img",{className:"tidecard",src:u,alt:o}),"CardOwner: ",c]})},k=n(91),C=n(95),E=n(94),y=n(93),N=Object(k.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120}}})),U=function(e){var r=e.value,n=e.valueOptions,t=e.label,a=e.handleChange,c=e.disabled,s=void 0!==c&&c,u=N(),o=n.map((function(e){return Object(x.jsx)("option",{value:e,children:e},e)})),i=t.toLowerCase(),l="".concat(i,"-native-label-placeholder");return Object(x.jsx)("div",{children:Object(x.jsxs)(E.a,{className:u.formControl,children:[Object(x.jsx)(C.a,{shrink:!0,htmlFor:l,children:t}),Object(x.jsxs)(y.a,{disabled:s,value:r,onChange:function(e){return a(e.target.value)},inputProps:{name:i,id:l},children:[Object(x.jsx)("option",{value:"",children:"None"}),o]})]})})},R=n(12),D=n.n(R),_=function(e){t=e?"bearer ".concat(e):null},I=function(){return{headers:{Authorization:t}}},A=_;console.log("production","http://localhost:3001/api");var T="./api",F="".concat(T,"/cards"),L=function(){var e=Object(d.a)(l.a.mark((function e(r){var n,t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=I(),e.next=4,D.a.post("".concat(F,"/select"),{cardIndex:r},n);case 4:return t=e.sent,a=t.data,e.abrupt("return",a);case 9:return e.prev=9,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(r){return e.apply(this,arguments)}}(),B={cardsSSE:function(){try{return new EventSource("".concat(F,"/sse"))}catch(e){console.error(e)}},forceEnd:function(){var e=Object(d.a)(l.a.mark((function e(){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=I(),e.next=4,D.a.get("".concat(F,"/forceEnd"),r);case 4:return n=e.sent,e.abrupt("return",204===n.status);case 8:return e.prev=8,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),nosword:function(){var e=Object(d.a)(l.a.mark((function e(){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=I(),e.next=4,D.a.get("".concat(F,"/nosword"),r);case 4:return n=e.sent,e.abrupt("return",204===n.status);case 8:return e.prev=8,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),select:L,initialLoad:function(){var e=Object(d.a)(l.a.mark((function e(){var r,n,t,a,c,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=I(),e.next=4,D.a.get("".concat(F,"/initialLoad"),r);case 4:return n=e.sent,t=n.data,a=t.selectedCards,c=a.ownCards,s=a.othersCards,e.abrupt("return",{swordOwner:t.swordOwner,ownCards:c,othersCards:s});case 10:return e.prev=10,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}()},G="".concat(T,"/users"),z={login:function(){var e=Object(d.a)(l.a.mark((function e(r){var n,t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=I(),e.next=4,D.a.post("".concat(G,"/login"),{username:r},n);case 4:if(t=e.sent,a=t.data.token){e.next=9;break}return console.error(t),e.abrupt("return",null);case 9:return _(a),e.abrupt("return",a);case 13:return e.prev=13,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(r){return e.apply(this,arguments)}}(),usernames:function(){var e=Object(d.a)(l.a.mark((function e(){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=I(),e.next=4,D.a.get("".concat(G,"/usernames"),r);case 4:return n=e.sent,e.abrupt("return",n.data||[]);case 8:return e.prev=8,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",["FAILED TO GET USERNAMES - REFRESH PAGE"]);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),stats:function(){var e=Object(d.a)(l.a.mark((function e(){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=I(),e.next=4,D.a.get("".concat(G,"/stats"),r);case 4:return n=e.sent,e.abrupt("return",n);case 8:return e.prev=8,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),changeSwordUser:function(){var e=Object(d.a)(l.a.mark((function e(r){var n,t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=I(),e.next=4,D.a.post("".concat(G,"/changeSwordUser"),{newSwordUser:r},n);case 4:return t=e.sent,e.abrupt("return",204===t.status);case 8:return e.prev=8,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(r){return e.apply(this,arguments)}}(),addUser:function(){var e=Object(d.a)(l.a.mark((function e(r){var n,t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=I(),e.next=4,D.a.post("".concat(G,"/add"),{username:r},n);case 4:return t=e.sent,e.abrupt("return",204===t.status);case 8:return e.prev=8,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(r){return e.apply(this,arguments)}}()},M=function e(r){var n=B.cardsSSE();return n.onopen=function(){console.log("CARD SUB ACTIVE")},n.onerror=function(){console.error("CARD SUB ERROR"),n.close(),setTimeout((function(){return e(r)}),1e4)},n.onmessage=function(e){console.log("CSUB MSG"),function(e,r){try{var n=JSON.parse(e);switch(n.msg){case"end":return n.cards,r((function(e){var r=n.cards,t=e.username,a=r.filter((function(e){return""!==e.cardOwner&&e.cardOwner!==t}));return Object(f.a)(Object(f.a)({},e),{},{cards:r,othersCards:a,waitingForSword:""})})),void console.log("ROUND END");case"nosword":return void console.log(n.username,"NOSWORD");case"select":return void r((function(e){var r=n.cardIndex,t=n.cardOwner;return e.cards[r].cardOwner=t,Object(f.a)({},e)}));case"forceEnd":return void console.log(n.username,"FORCE END");case"too-many-users":return void console.log("TOO MANY USER SELECTED CARDS",n.usernames);case"waiting-sword":return void r((function(e){return Object(f.a)(Object(f.a)({},e),{},{waitingForSword:n.username})}));case"sword-change":return console.log(n.doneBy,"SWORD USER CHANGED TO",n.username),void r((function(e){return Object(f.a)(Object(f.a)({},e),{},{swordOwner:n.username})}));default:console.error("UNDEFINED SSE MSG",n)}}catch(t){console.error(t,e)}}(e.data,r)},n},W=function(e){var r=e.cardStates,n=r.swordOwner===r.username,t=function(){var e=Object(d.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=t)!==r.swordOwner&&n){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,z.changeSwordUser(a);case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();return Object(x.jsx)(U,{value:r.swordOwner,valueOptions:r.usernameOptions,handleChange:t,label:"SwordOwner",disabled:!n})},J=function(){for(var e=[],r=0;r<24;r++)e.push({cardName:"",cardOwner:"",cardIndex:r});return e},H=function(e){var r=e.username,n=e.usernameOptions,t=e.logout,c=Object(a.useState)((function(){return function(e,r){return{cards:J(),selectedCards:[],ownCards:[],othersCards:[],waitingForSword:"",swordOwner:"",usernameOptions:r,username:e}}(r,n)})),s=Object(o.a)(c,2),u=s[0],i=s[1];Object(a.useEffect)((function(){(function(){var e=Object(d.a)(l.a.mark((function e(){var r,n,t,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.initialLoad();case 2:r=e.sent,n=r.swordOwner,t=r.ownCards,a=r.othersCards,c=[].concat(Object(p.a)(t),Object(p.a)(a)),i((function(e){var r=e.cards;return c.forEach((function(e){var n=e.cardOwner,t=e.cardIndex;r[t].cardOwner=n})),Object(f.a)(Object(f.a)({},e),{},{cards:r,swordOwner:n,ownCards:t,othersCards:a})}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()();var e=M(i);return function(){return e.close()}}),[]);var b=function(){var e=Object(d.a)(l.a.mark((function e(r){var n,t,a,c,s,o,d,p,b;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.username,t=u.swordOwner,a=u.cards,c=u.ownCards,s=u.othersCards,""===a[r].cardOwner){e.next=4;break}return e.abrupt("return");case 4:if(o=a.filter((function(e){return""!==e.cardOwner})),d=o.filter((function(e){return e.cardOwner===n})),1!==o.length||1!==d.length){e.next=8;break}return e.abrupt("return");case 8:if(2!==o.length||1===d.length&&t===n){e.next=10;break}return e.abrupt("return");case 10:if(p=[c.length,s.length,o.length],p[0]+p[1]===p[2]){e.next=13;break}return e.abrupt("return");case 13:return e.next=15,B.select(r);case 15:if(b=e.sent){e.next=18;break}return e.abrupt("return");case 18:i((function(e){return e.ownCards.push(b),Object(f.a)({},e)}));case 19:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),O=function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h===r){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,B.nosword();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v=function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.forceEnd();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=u.swordOwner,w=u.cards.map((function(e){return Object(x.jsx)(S,{username:r,card:e,handleSelect:b},e.cardIndex)})),j=h===r,m=!1;if(j){var g=u.cards.filter((function(e){return""!==e.cardOwner})),k=g.filter((function(e){return e.cardOwner===r}));2===g.length&&1===k.length&&(m=!0)}return Object(x.jsxs)("div",{children:[Object(x.jsxs)("div",{style:{display:"flex"},children:[Object(x.jsxs)("button",{onClick:function(){return t()},children:["Logout - ",r]}),Object(x.jsx)(W,{cardStates:u})]}),Object(x.jsxs)("div",{style:{display:"grid"},children:[Object(x.jsx)("div",{style:{display:"flex",overflow:"auto"},children:w}),j&&Object(x.jsx)("button",{disabled:!m,onClick:O,children:"DONT USE SWORD"}),Object(x.jsx)("div",{style:{height:55}}),j&&Object(x.jsx)("button",{onClick:v,children:"FORCE RESET - FOR BUGS ONLY"}),Object(x.jsx)("div",{})]})]})},P=(n(68),function(e,r){localStorage.setItem("Username",e),localStorage.setItem("Token",r)}),Y=function(e){var r=e.username,n=e.setUsername,t=e.usernameOptions,a=function(){var e=Object(d.a)(l.a.mark((function e(r){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=r)&&"None"!==t){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,z.login(t);case 5:if(a=e.sent){e.next=9;break}return console.log("login failed"),e.abrupt("return");case 9:P(t,a),n(t);case 11:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();return Object(x.jsx)(U,{value:r,valueOptions:t,handleChange:a,label:"Username"})},V=function(){var e=Object(a.useState)((function(){return function(){var e=localStorage.getItem("Username"),r=localStorage.getItem("Token");return e&&r?(A(r),e):""}()})),r=Object(o.a)(e,2),n=r[0],t=r[1],c=Object(a.useState)([]),s=Object(o.a)(c,2),u=s[0],i=s[1];if(Object(a.useEffect)((function(){(function(){var e=Object(d.a)(l.a.mark((function e(){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.usernames();case 2:r=e.sent,i(r);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),!n)return Object(x.jsx)("div",{className:"App",children:Object(x.jsx)(Y,{username:n,setUsername:t,usernameOptions:u})});return Object(x.jsx)("div",{className:"App",children:u.length>0?Object(x.jsx)(H,{logout:function(){localStorage.clear(),t("")},username:n,usernameOptions:u}):"Loading..."})};u.a.render(Object(x.jsx)(c.a.StrictMode,{children:Object(x.jsx)(V,{})}),document.getElementById("root"))}},[[69,1,2]]]);
//# sourceMappingURL=main.a2466932.chunk.js.map